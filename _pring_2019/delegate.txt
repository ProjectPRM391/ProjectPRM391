using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Delegate
{
    class Program
    {
        //Dinh nghia 1 delegate
        //Dai dien cho cac ham co kieu (int , int) -> (int)
        delegate int IntIntToInt(int a, int b);
        delegate int returnPrice(int a);

        static void Main(string[] args)
        {

            returnPrice ab = new returnPrice(Test.printMessage);
            //Tao 1 doi tuong delegate
            //Truyen (pass) vao tham so la mot ham co cung kieu voi delegate
            IntIntToInt iiToInt = new IntIntToInt(MathUtils.sum);

            int value2 = ab(2);
            //Khi ban thuc thi mot delegate
            //No se goi ham (hoac phuong thuc) ma no dai dien
            int value = iiToInt(10, 20);

            Console.WriteLine("Sum delegate value = {0} ", value2);
            Console.WriteLine("Sum delegate value = {0} ", value);

            float salary = 1000f;

            TaxFormul.TaxFormula_01 formula = TaxFormul.GetSalaryFormula("VN");

            float tax = formula(salary);

            Console.WriteLine("Tax in Vietnam = {0}", tax);

            MyEvent myApp = new MyEvent();

            Console.WriteLine("User Click on Open Button ....");

            //Mo phong openButton bi click
            myApp.openButton.Clicked();

            Console.WriteLine("User Click on Save Button ...");
            myApp.saveButton.Clicked();
            Console.ReadLine();

            //Gan gia tri khac cho delegate
        }
    }
}



///delegate khong o trang main
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Delegate
{
    class TaxFormul
    {
        //Mot delegate dai dien cho cac ham kieu (float) -> (float)
        public delegate float TaxFormula_01(float salary);

        public static float UsaFormula(float salary)
        {
            return 10 * salary / 100;
        }

        public static float VietnamFormula(float salary)
        {
            return 5 * salary / 100;
        }

        public static float DefaultFormula(float salary)
        {
            return 7 * salary / 100;
        }

        public static TaxFormula_01 GetSalaryFormula(string countryCode)
        {
            if(countryCode == "VN")
            {
                return TaxFormul.VietnamFormula;
            }
            else if( countryCode == "USA")
            {
                return TaxFormul.UsaFormula;
                
            }
            return TaxFormul.DefaultFormula;
        }
    }
}
////VA Tao su kien
Khai báo Event trong C#
Ð? khai báo m?t Event bên trong m?t l?p, d?u tiên m?t ki?u delegate cho Event dó ph?i du?c khai báo. Ví d?:

public delegate void BoilerLogHandler(string status);
Ti?p theo, chính Event dó du?c khai báo, b?i s? d?ng t? khóa event trong C#:

//d?nh nghia event d?a vào delegate ? trên
public event BoilerLogHandler BoilerEventLog;
Code trên d?nh nghia m?t delegate v?i tên là BoilerLogHandler và m?t Event v?i tên là BoilerEventLog, mà tri?u h?i delegate dó khi nó du?c t?o ra.

Ví d? 1
T?o hai l?p có tên l?n lu?t là EventTest, TestCsharp nhu sau:

L?p EventTest:

using System;

namespace VietJackCsharp
{
    class EventTest
    {
        private int value;
        public delegate void NumManipulationHandler();
        public event NumManipulationHandler ChangeNum;
        protected virtual void OnNumChanged()
        {
            if (ChangeNum != null)
            {
                ChangeNum();
            }
            else
            {
                Console.WriteLine("Kich hoat su kien!");
            }
        }

        public EventTest(int n)
        {
            SetValue(n);
        }

        public void SetValue(int n)
        {
            if (value != n)
            {
                value = n;
                OnNumChanged();
            }
        }
    }
}

 
L?p TestCsharp:

using System;

namespace VietJackCsharp
{
    class TestCsharp
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Vi du minh hoa Su kien (Event) trong C#");
            Console.WriteLine("----------------------------------");
            //tao doi tuong EventTest
            EventTest e = new EventTest(5);
            e.SetValue(7);
            e.SetValue(11);
            Console.ReadKey();
        }
    }
}

